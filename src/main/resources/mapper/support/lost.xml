<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.mgv.support.dao.LostDao">

	<insert id="insertLost" parameterType="kr.co.mgv.support.vo.Lost">
		INSERT INTO MGV_SUPPORT_LOST
		(lost_title, lost_content, lost_filename,
		user_id, user_name, user_email,
		location_no, theater_no,
		lost_guest_name, lost_guest_email, lost_guest_password)
		values
		(#{title}, #{content}, #{fileName}, 
	    #{user.id}, #{user.name}, #{user.email}, 
	    #{location.no}, #{theater.no}, 
	    #{guestName}, #{guestEmail}, #{guestPassword});
				
	</insert>
	
	<select id="getTotalRows" parameterType="map" resultType="int">
		select count(*)
		FROM MGV_SUPPORT_LOST A, MGV_LOCATION B , MGV_THEATERS C
		where 
			A.LOCATION_NO = B.LOCATION_NO
			and B.LOCATION_NO = C.LOCATION_NO
			and A.LOST_DELETED = 'N'
			<if test="locationNo != null">
				and A.LOCATION_NO = #{locationNo}
			</if>
			<if test="theaterNo != null">
				and A.THEATER_NO = #{theaterNo}
			</if>
			<if test="answered != null">
				and A.LOST_ANSWERED = #{answered}
			</if>
			<if test="keyword != null">
				and A.LOST_TITLE like  CONCAT('%', #{keyword}, '%')	
			</if>
	</select>
	
	<select id="getlosts" parameterType="map" resultType="kr.co.mgv.support.vo.Lost">
		SELECT 
			A.Lost_NO				as no, 
			A.LOST_TITLE			as title, 
			A.LOST_CONTENT			as content, 
			A.LOST_ANSWERED			as answered, 
			A.LOST_DELETED			as deleted, 
			A.LOST_FILENAME			as fileName, 
			A.LOST_UPDATE_DATE		as updateDate,
			A.LOST_CREATE_DATE		as createDate, 
			A.LOCATION_NO			as "location.no",
			B.Location_name			as "location.name",
			A.THEATER_NO 			as "theater.no",
			C.theater_name			as "theater.name"
		FROM MGV_SUPPORT_LOST A, MGV_LOCATION B , MGV_THEATERS C
		where 
			A.LOCATION_NO = B.LOCATION_NO
			and B.LOCATION_NO = C.LOCATION_NO
			and A.LOST_DELETED = 'N'
			<if test="locationNo != null">
				and A.LOCATION_NO = #{locationNo}
			</if>
			<if test="theaterNo != null">
				and A.THEATER_NO = #{theaterNo}
			</if>
			<if test="answered != null">
				and A.LOST_ANSWERED = #{answered}
			</if>
			<if test="keyword != null">
				and A.LOST_TITLE like  CONCAT('%', #{keyword}, '%')	
			</if>
		order by
			A.Lost_NO DESC
		LIMIT 10 OFFSET #{begin}
	</select>
	
	<select id="getLostByNo" parameterType="int" resultType="kr.co.mgv.support.vo.Lost">
		SELECT 
			A.Lost_NO				as no, 
			A.LOST_TITLE			as title, 
			A.LOST_CONTENT			as content, 
			A.LOST_ANSWERED			as answered, 
			A.LOST_DELETED			as deleted, 
			A.LOST_FILENAME			as fileName, 
			A.LOST_UPDATE_DATE		as updateDate,
			A.LOST_CREATE_DATE		as createDate, 
			A.LOCATION_NO			as "location.no",
			B.Location_name			as "location.name",
			A.THEATER_NO 			as "theater.no",
			C.theater_name			as "theater.name",
			D.user_email			as "user.email"
		FROM 
			MGV_SUPPORT_LOST A, MGV_LOCATION B , MGV_THEATERS C, MGV_USER D
		where 
			A.LOCATION_NO = B.LOCATION_NO
			and A.theater_NO = C.theater_NO
			and A.user_email = D.user_email
			and A.Lost_NO = #{value} 
	</select>
	
	
	
	
	
	<select id="getLocations" resultType="kr.co.mgv.theater.vo.Location">
		SELECT
    		location_no		as no,
    		location_name	as name
    	from MGV_LOCATION
	</select>
	
	<select id="getTheatersByLocationNo" parameterType="int" resultType="kr.co.mgv.theater.vo.Theater">
		SELECT 
    		A.theater_no		as no,
    		A.theater_name		as name,
    		A.location_no		as "location.no",
    		B.location_name		as "location.name"
    	from MGV_THEATERS A, MGV_LOCATION B
    	where
    		A.location_no = B.location_no 
    		and A.location_no = #{value}
	</select>

</mapper>